<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 700" role="img" aria-label="Policy enforcement point (back controller) and on-chain commitments">
  <defs>
    <style>
      .title { font: 700 22px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #0f172a; }
      .groupTitle { font: 700 16px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #0f172a; }
      .boxTitle { font: 700 13px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #0f172a; }
      .boxText { font: 12px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #334155; }
      .box { fill: #ffffff; stroke: #94a3b8; stroke-width: 1; rx: 12; }
      .gSrv { fill: #eff6ff; stroke: #2563eb; stroke-width: 2; rx: 18; }
      .gChain { fill: #f5f3ff; stroke: #7c3aed; stroke-width: 2; rx: 18; }
      .arrow { stroke: #334155; stroke-width: 2; fill: none; marker-end: url(#arrowHead); }
      .arrowOpt { stroke: #64748b; stroke-width: 2; stroke-dasharray: 6 6; fill: none; marker-end: url(#arrowHead); }
    </style>
    <marker id="arrowHead" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#334155"/>
    </marker>
  </defs>

  <text class="title" x="40" y="48">Policy Enforcement (“Back Controller” / PEP)</text>

  <!-- Groups -->
  <rect class="gSrv" x="40" y="80" width="560" height="560" />
  <rect class="gChain" x="680" y="80" width="480" height="560" />

  <text class="groupTitle" x="60" y="115">Server runtime</text>
  <text class="groupTitle" x="700" y="115">EVM chain</text>

  <!-- Server boxes -->
  <rect class="box" x="80" y="150" width="480" height="90" />
  <text class="boxTitle" x="100" y="180">Application code</text>
  <text class="boxText" x="100" y="200">PHP / JS / workers</text>

  <rect class="box" x="80" y="265" width="480" height="110" />
  <text class="boxTitle" x="100" y="295">PEP (“Back Controller”)</text>
  <text class="boxText" x="100" y="315">blackcat-core + blackcat-config</text>
  <text class="boxText" x="100" y="333">- load policy</text>
  <text class="boxText" x="100" y="351">- verify chain (quorum)</text>
  <text class="boxText" x="100" y="369">- allow/deny sensitive ops</text>

  <rect class="box" x="80" y="400" width="480" height="90" />
  <text class="boxTitle" x="100" y="430">Secrets boundary</text>
  <text class="boxText" x="100" y="450">keys / decrypt / KMS/HSM</text>

  <rect class="box" x="80" y="515" width="480" height="90" />
  <text class="boxTitle" x="100" y="545">Database</text>
  <text class="boxText" x="100" y="565">localhost only + encrypted fields</text>

  <!-- Chain boxes -->
  <rect class="box" x="720" y="160" width="400" height="90" />
  <text class="boxTitle" x="740" y="190">InstanceController</text>
  <text class="boxText" x="740" y="210">activeRoot / uriHash / policyHash</text>

  <rect class="box" x="720" y="275" width="400" height="90" />
  <text class="boxTitle" x="740" y="305">ReleaseRegistry (optional)</text>
  <text class="boxText" x="740" y="325">trusted roots + revocations</text>

  <rect class="box" x="720" y="390" width="400" height="90" />
  <text class="boxTitle" x="740" y="420">ManifestStore (optional)</text>
  <text class="boxText" x="740" y="440">policy bytes availability-on-chain</text>

  <!-- Arrows -->
  <path class="arrow" d="M 320 240 L 320 265" />
  <path class="arrow" d="M 560 320 L 720 205" />
  <path class="arrowOpt" d="M 560 330 L 720 320" />
  <path class="arrowOpt" d="M 560 340 L 720 435" />
  <path class="arrow" d="M 320 375 L 320 400" />
  <path class="arrow" d="M 320 490 L 320 515" />
</svg>

